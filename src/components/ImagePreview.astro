---
---

<!-- Image Preview Modal -->
<div id="image-preview-modal" class="image-preview-modal">
    <span class="close-preview">&times;</span>
    <img class="preview-content" id="preview-image" alt="Preview">
    <div id="preview-caption"></div>
</div>

<style>
    /* Image Preview Modal */
    .image-preview-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.9);
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }
    .preview-content {
        margin: auto;
        display: block;
        max-width: 90%;
        max-height: 90vh;
        object-fit: contain;
        animation-name: zoom;
        animation-duration: 0.3s;
    }
    #preview-caption {
        margin: auto;
        display: block;
        width: 80%;
        max-width: 700px;
        text-align: center;
        color: #ccc;
        padding: 10px 0;
        height: auto;
        margin-top: 10px;
    }
    .close-preview {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
        cursor: pointer;
        z-index: 1001;
    }
    .close-preview:hover,
    .close-preview:focus {
        color: #bbb;
        text-decoration: none;
        cursor: pointer;
    }
    @keyframes zoom {
        from {transform:scale(0)}
        to {transform:scale(1)}
    }
    /* Global style for zoom-in cursor on prose images */
    :global(.prose img) {
        cursor: zoom-in;
    }
</style>

<script>
    function initImagePreview() {
        const modal = document.getElementById('image-preview-modal');
        const modalImg = document.getElementById('preview-image') as HTMLImageElement;
        const captionText = document.getElementById('preview-caption');
        const closeBtn = document.querySelector('.close-preview');

        if (!modal || !modalImg || !closeBtn || !captionText) return;

        // Get all images in the article prose
        const images = document.querySelectorAll('.prose img');

        images.forEach(img => {
            // Skip images that are already links (if any) to avoid conflict
            if (img.parentElement && img.parentElement.tagName === 'A') return;

            img.addEventListener('click', (e) => {
                const target = e.currentTarget as HTMLImageElement;
                modal.style.display = "flex";
                // Use the src of the clicked image
                modalImg.src = target.src;
                captionText.innerHTML = target.alt;
            });
        });

        // Close on click close button
        closeBtn.addEventListener('click', function() {
            modal.style.display = "none";
        });

        // Close on click outside image
        modal.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        });
        
        // Close on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape" && modal.style.display === "flex") {
                modal.style.display = "none";
            }
        });
    }

    // Run on initial load
    initImagePreview();

    // Support for view transitions
    document.addEventListener('astro:page-load', initImagePreview);
</script>
